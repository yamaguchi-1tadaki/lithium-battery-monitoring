# 🛠️ トラブルシューティングガイド - リチウムイオンバッテリー監視システム

## 📋 目次
1. [一般的な問題と解決方法](#一般的な問題と解決方法)
2. [ログイン・認証の問題](#ログイン認証の問題)
3. [データ表示の問題](#データ表示の問題)
4. [リアルタイム更新の問題](#リアルタイム更新の問題)
5. [AI予測機能の問題](#ai予測機能の問題)
6. [パフォーマンスの問題](#パフォーマンスの問題)
7. [ネットワーク・接続の問題](#ネットワーク接続の問題)
8. [データベースの問題](#データベースの問題)
9. [システム管理の問題](#システム管理の問題)
10. [エラーログの確認方法](#エラーログの確認方法)

---

## 一般的な問題と解決方法

### 🔄 ページが正しく表示されない

#### 症状
- 白い画面が表示される
- レイアウトが崩れている
- 一部の要素が表示されない

#### 原因と解決方法

**1. ブラウザキャッシュの問題**
```bash
解決手順:
1. Ctrl + Shift + Delete でキャッシュクリア
2. ページをリロード (F5 または Ctrl + R)
3. ハードリロード (Ctrl + Shift + R)
```

**2. JavaScriptが無効**
```bash
解決手順:
1. ブラウザ設定でJavaScriptを有効化
2. アドブロッカーを無効化
3. プライベートモードで試行
```

**3. 対応ブラウザでない**
```bash
対応ブラウザ:
✅ Chrome 90+ (推奨)
✅ Firefox 88+
✅ Edge 90+
✅ Safari 14+
❌ Internet Explorer (非対応)
```

### 🐌 システムが重い・遅い

#### 症状
- ページの読み込みが遅い
- グラフの更新が遅れる
- ボタンの反応が悪い

#### 解決方法

**1. ネットワーク確認**
```bash
# 接続速度テスト
curl -o /dev/null -s -w "%{time_total}\n" https://5000-iqgwx5r4z3myowhrkmifd-6532622b.e2b.dev/api/health

# 期待値: 1秒以下
```

**2. ブラウザ最適化**
```bash
解決手順:
1. 他のタブを閉じる
2. ブラウザの拡張機能を無効化
3. ブラウザを再起動
4. 別のブラウザで試行
```

**3. システムリソース確認**
```bash
# 管理者の場合
1. /admin でシステム統計確認
2. CPU使用率 < 80%
3. メモリ使用率 < 85%
4. 必要に応じてシステム管理者に連絡
```

---

## ログイン・認証の問題

### 🔐 ログインできない

#### 症状 1: "ユーザー名またはパスワードが間違っています"

**確認事項:**
```bash
✅ 正しいユーザー名・パスワード
   - admin / admin123
   - operator / operator123  
   - viewer / viewer123

✅ 大文字・小文字の確認
✅ 全角・半角の確認
✅ スペースの有無確認
```

**解決手順:**
```bash
1. パスワードをコピー&ペーストで入力
2. ブラウザのパスワード自動入力を無効化
3. プライベートモードで試行
4. 別のブラウザで試行
```

#### 症状 2: ログイン画面が表示されない

**解決手順:**
```bash
1. URLの確認:
   https://5000-iqgwx5r4z3myowhrkmifd-6532622b.e2b.dev

2. ネットワーク接続確認
3. DNS設定確認
4. ファイアウォール設定確認
```

#### 症状 3: ログイン後すぐにログアウトされる

**原因と解決方法:**
```bash
原因: セッション設定の問題
解決:
1. ブラウザのクッキー設定を確認
2. サードパーティクッキーを有効化
3. セキュリティソフトの設定確認
4. ブラウザのプライベートモードで試行
```

### 👤 権限エラー

#### 症状: "権限がありません"エラー

**権限レベル確認:**
```bash
管理者 (admin):
✅ 全機能利用可能
✅ システム設定変更
✅ ユーザー管理

操作者 (operator):
✅ データ閲覧・操作
✅ アラート管理
❌ システム設定変更

閲覧者 (viewer):
✅ データ閲覧のみ
❌ データ変更
❌ システム設定
```

**解決方法:**
```bash
1. 現在のユーザー権限を確認
2. 必要な権限レベルでログイン
3. 管理者に権限昇格を依頼
```

---

## データ表示の問題

### 📊 グラフが表示されない

#### 症状 1: グラフエリアが空白

**解決手順:**
```bash
1. バッテリー選択を確認
   - 左側リストから監視対象バッテリーを選択
   
2. データ期間を確認
   - 期間ボタン (1h/6h/24h) を変更
   
3. ブラウザコンソールでエラー確認
   - F12 → Console タブでエラー確認
```

#### 症状 2: "データがありません"メッセージ

**原因確認:**
```bash
1. バッテリーのセンサーデータ収集状況
2. データベース接続状況  
3. 指定期間内のデータ有無
```

**解決方法:**
```bash
1. 別のバッテリーで試行
2. 期間を長くして試行
3. 管理者画面でデータ状況確認
4. システム管理者に連絡
```

#### 症状 3: グラフが部分的にしか表示されない

**解決方法:**
```bash
1. ブラウザウィンドウサイズを調整
2. ズーム倍率を100%に設定
3. グラフをダブルクリックでリセット
4. ページをリロード
```

### 🔢 データが古い・更新されない

#### 症状: 最新データが反映されない

**確認事項:**
```bash
✅ WebSocket接続状況
✅ ネットワーク接続
✅ ブラウザタブがアクティブ
✅ データ収集システム状況
```

**解決手順:**
```bash
1. ページをリロード (F5)
2. ブラウザタブをアクティブにする
3. WebSocket再接続:
   - 別のバッテリーを選択
   - 元のバッテリーに戻る
   
4. 管理者画面でシステム状況確認
```

---

## リアルタイム更新の問題

### 🔌 WebSocket接続エラー

#### 症状: "接続が切断されました"メッセージ

**原因:**
- ネットワーク不安定
- プロキシ・ファイアウォール
- サーバー側の問題

**解決方法:**
```bash
1. ネットワーク接続確認
2. プロキシ設定確認
3. ファイアウォール設定確認
4. 管理者に連絡
```

#### 症状: データが断続的に更新される

**解決方法:**
```bash
1. ブラウザタブをアクティブ状態に保つ
2. 省電力モードを無効化
3. 他のリソース集約的なアプリを終了
4. 有線LAN接続に変更
```

### ⏱️ 更新頻度の問題

#### 症状: 更新が遅い・頻繁すぎる

**設定確認:**
```bash
デフォルト更新間隔:
- センサーデータ: 1分
- AI予測: 5分  
- アラート: 30秒
- システム統計: 1分
```

**調整方法:**
```bash
管理者権限で:
1. /admin → システム設定
2. 更新間隔の調整
3. 変更を保存
4. システム再起動 (必要に応じて)
```

---

## AI予測機能の問題

### 🤖 AI予測が表示されない

#### 症状 1: "予測データがありません"

**原因:**
- 学習データ不足
- モデル学習未完了
- AI処理エラー

**解決手順:**
```bash
1. 管理者画面でAI学習状況確認
2. 必要な最小データ点数確認 (100点以上)
3. モデル再学習実行
4. エラーログ確認
```

#### 症状 2: 予測精度が低い

**改善方法:**
```bash
1. 学習データ期間を延長 (30日→90日)
2. データ品質向上:
   - 異常データの除外
   - センサー校正
   
3. モデルパラメータ調整:
   - 管理画面 → AI設定
   - 感度・閾値の調整
   
4. 定期的なモデル再学習 (週1回推奨)
```

#### 症状 3: AI処理が異常に遅い

**解決方法:**
```bash
1. システムリソース確認:
   - CPU使用率 < 80%
   - メモリ使用量 < 85%
   
2. 同時処理数を制限:
   - 管理画面 → システム設定
   - AI処理の並列数調整
   
3. 学習データサイズを最適化
4. システム管理者に相談
```

### 📊 異常検知の精度問題

#### 症状: 誤検知が多い

**調整方法:**
```bash
1. 異常検知感度を下げる:
   - 管理画面 → AI設定
   - 閾値を0.1 → 0.05に調整
   
2. 正常データでの再学習:
   - 誤検知データを正常として学習
   
3. 季節変動・使用パターンを考慮:
   - 学習期間を1年間に延長
```

#### 症状: 異常を検知できない

**改善方法:**
```bash
1. 異常検知感度を上げる:
   - 閾値を0.1 → 0.2に調整
   
2. 既知の異常データを学習:
   - 過去の故障例を学習データに追加
   
3. 特徴量エンジニアリング:
   - 物理的特徴量の追加
   - 統計的特徴量の最適化
```

---

## パフォーマンスの問題

### 🐌 システム全体が遅い

#### システムリソース確認

**CPU使用率が高い場合 (>80%)**
```bash
原因:
- AI予測処理の集中
- データベースの非効率なクエリ
- 同時接続ユーザー数過多

解決方法:
1. AI処理の並列数制限
2. データベースインデックス最適化
3. 接続ユーザー数制限
4. サーバーリソース増強
```

**メモリ使用量が高い場合 (>85%)**
```bash
原因:
- メモリリーク
- 大容量データの保持
- キャッシュサイズ過大

解決方法:
1. システム再起動
2. キャッシュサイズ調整
3. 古いデータのアーカイブ
4. メモリ容量増強
```

### 💾 データベース性能問題

#### 症状: クエリが遅い

**解決方法:**
```bash
1. データベース最適化:
   ANALYZE;
   VACUUM;
   REINDEX;
   
2. インデックスの確認・追加:
   - timestamp列のインデックス
   - battery_id列のインデックス
   
3. 古いデータのアーカイブ:
   - 3ヶ月以上のデータを別テーブルに移動
   
4. クエリの最適化:
   - 不要なJOINの削除
   - WHEREの最適化
```

#### 症状: データベース接続エラー

**解決方法:**
```bash
1. 接続プール設定確認:
   - 最大接続数
   - タイムアウト設定
   
2. データベースファイル容量確認
3. ディスク容量確認
4. データベース修復:
   sqlite3 battery_monitor.db ".schema" > schema.sql
```

---

## ネットワーク・接続の問題

### 🌐 インターネット接続の問題

#### 症状: "サーバーに接続できません"

**診断手順:**
```bash
1. 基本的な接続確認:
   ping 8.8.8.8
   
2. DNS解決確認:
   nslookup 5000-iqgwx5r4z3myowhrkmifd-6532622b.e2b.dev
   
3. HTTPSアクセス確認:
   curl -I https://5000-iqgwx5r4z3myowhrkmifd-6532622b.e2b.dev
   
4. ポート443の開放確認
```

**解決方法:**
```bash
1. ネットワーク設定確認
2. プロキシ設定確認
3. ファイアウォール設定確認
4. 別のネットワークで試行
```

### 🔒 SSL証明書の問題

#### 症状: "安全でない接続"警告

**解決方法:**
```bash
1. システム時刻の確認・同期
2. ブラウザキャッシュクリア
3. 証明書の手動更新:
   - 設定 → セキュリティ → 証明書管理
   
4. 管理者に証明書更新を依頼
```

### 📡 プロキシ・ファイアウォールの問題

#### 症状: 一部機能が動作しない

**確認事項:**
```bash
必要なポート・プロトコル:
- HTTPS (443): Web画面アクセス
- WebSocket (443): リアルタイム更新
- DNS (53): 名前解決

許可が必要なドメイン:
- 5000-iqgwx5r4z3myowhrkmifd-6532622b.e2b.dev
- CDNドメイン (Bootstrap, Chart.js等)
```

---

## データベースの問題

### 💽 データベース破損

#### 症状: "データベースエラー"メッセージ

**診断方法:**
```bash
# データベース整合性チェック
sqlite3 battery_monitor.db "PRAGMA integrity_check;"

# 期待結果: "ok"
# 問題がある場合: 具体的なエラーメッセージ
```

**修復方法:**
```bash
1. データベースバックアップ作成:
   cp battery_monitor.db battery_monitor_backup.db
   
2. 修復実行:
   sqlite3 battery_monitor.db ".recover" | sqlite3 battery_monitor_fixed.db
   
3. 修復結果確認:
   sqlite3 battery_monitor_fixed.db "PRAGMA integrity_check;"
   
4. データベース置き換え:
   mv battery_monitor.db battery_monitor_broken.db
   mv battery_monitor_fixed.db battery_monitor.db
```

### 📊 データ欠損・不整合

#### 症状: データが期待値と異なる

**確認クエリ:**
```sql
-- データ件数確認
SELECT 
    COUNT(*) as total,
    COUNT(CASE WHEN is_valid = 1 THEN 1 END) as valid,
    COUNT(CASE WHEN is_valid = 0 THEN 1 END) as invalid
FROM sensor_data;

-- 最新データ確認
SELECT * FROM sensor_data 
ORDER BY timestamp DESC 
LIMIT 10;

-- バッテリー別データ数
SELECT 
    b.battery_id,
    COUNT(s.id) as data_count,
    MAX(s.timestamp) as latest_data
FROM batteries b
LEFT JOIN sensor_data s ON b.id = s.battery_id
GROUP BY b.id;
```

**データ修復:**
```bash
1. 明らかに異常なデータの除外:
   UPDATE sensor_data 
   SET is_valid = 0 
   WHERE voltage < 0 OR voltage > 5 
   OR temperature < -50 OR temperature > 100;
   
2. 重複データの削除:
   DELETE FROM sensor_data 
   WHERE id NOT IN (
     SELECT MIN(id) 
     FROM sensor_data 
     GROUP BY battery_id, timestamp
   );
```

---

## システム管理の問題

### 👨‍💼 管理者権限の問題

#### 症状: 管理画面にアクセスできない

**確認事項:**
```bash
✅ 管理者権限でログインしているか
✅ 正しいURLにアクセスしているか
   /admin または /api/admin
✅ セッションが有効か
```

**解決方法:**
```bash
1. 管理者アカウントで再ログイン
2. ブラウザキャッシュクリア
3. 直接URLアクセス:
   https://5000-iqgwx5r4z3myowhrkmifd-6532622b.e2b.dev/admin
```

### 🔧 設定変更が反映されない

#### 症状: 変更した設定が適用されない

**解決手順:**
```bash
1. 設定保存の確認:
   - 「保存」ボタンのクリック確認
   - 成功メッセージの確認
   
2. システム再起動 (必要な場合):
   - 管理画面 → システム制御 → 再起動
   
3. ブラウザキャッシュクリア
4. 別のブラウザで確認
```

### 📈 バックアップ・復元の問題

#### 症状: バックアップが失敗する

**原因と解決方法:**
```bash
原因1: ディスク容量不足
解決: df -h でディスク容量確認、不要ファイル削除

原因2: 権限不足
解決: バックアップディレクトリの権限確認

原因3: データベースロック
解決: システム一時停止後にバックアップ実行
```

---

## エラーログの確認方法

### 📋 ログファイルの場所

```bash
システムログ:
/home/user/webapp/logs/system.log

アプリケーションログ:
/home/user/webapp/logs/app.log

エラーログ:
/home/user/webapp/logs/error.log

AI処理ログ:
/home/user/webapp/logs/ml.log
```

### 🔍 ログ確認コマンド

```bash
# 最新100行のログ確認
tail -100 /home/user/webapp/logs/system.log

# リアルタイムログ監視
tail -f /home/user/webapp/logs/system.log

# エラーのみ抽出
grep -i error /home/user/webapp/logs/system.log

# 特定時間のログ確認
grep "2025-01-01 12:" /home/user/webapp/logs/system.log
```

### 📊 ブラウザ開発者ツール

**開発者ツールの開き方:**
- Chrome/Edge: F12 または Ctrl+Shift+I
- Firefox: F12 または Ctrl+Shift+K
- Safari: Cmd+Option+I

**確認すべき項目:**
```bash
1. Console タブ:
   - JavaScriptエラー
   - API呼び出しエラー
   - WebSocket接続状況

2. Network タブ:
   - HTTP リクエスト/レスポンス
   - 失敗したリクエスト (赤色表示)
   - レスポンス時間

3. Application タブ:
   - Local Storage
   - Session Storage  
   - Cookies
```

---

## 📞 サポート連絡時の情報

### 📋 報告すべき情報

**基本情報:**
```bash
✅ 発生日時
✅ 症状の詳細説明
✅ 操作手順
✅ エラーメッセージ (正確な文言)
✅ 使用ブラウザとバージョン
✅ OS とバージョン
```

**技術情報:**
```bash
✅ ブラウザコンソールのエラー
✅ ネットワーク状況
✅ 同じ症状の発生頻度
✅ 他のユーザーでも発生するか
✅ 試した解決方法とその結果
```

### 📧 連絡先

**技術サポート:**
- **平日**: 9:00-18:00 (JST)
- **緊急時**: 24時間対応 (CRITICAL レベルのみ)

**報告方法:**
1. システム内お問い合わせフォーム (推奨)
2. 電話サポート
3. メール
4. GitHub Issues (技術的な問題)

---

**📅 最終更新**: 2025年10月5日  
**📖 ガイドバージョン**: 1.0.0  
**👨‍💼 作成者**: PFU事業開発本部 次世代事業開発室  
**🎯 対象システム**: リチウムイオンバッテリーAI予兆検知システム v1.0

---

*このガイドで解決しない問題については、システム管理者またはテクニカルサポートまでお気軽にお問い合わせください。PFUの技術チームが迅速にサポートいたします。*